<html>
<head>

    <style>

        body {
            background: black;
        }

        audio {
            margin: auto;
            display: block;
            /*vertical-align: center;*/
        }

        canvas {
            width: 100%;
            height: 80%;
            /*border: solid 1px red;*/
        }

    </style>
</head>

<body>

<canvas ></canvas>
<audio src="fur_elise_audio.mp3" controls></audio>

</body>

<script>

    const audio = document.querySelector('audio');
    const canvas = document.querySelector('canvas');
    const ctx = canvas.getContext('2d');

    let isInit = false;
    let dataArray,  analyzer;
    function initCanvas() {
        canvas.width = window.innerWidth * devicePixelRatio;
        canvas.height = window.innerWidth / 2 * devicePixelRatio
    }

    initCanvas();

    audio.onplay = function () {
        if (isInit) {
            return;
        }

        const audioCtx = new AudioContext();
        const source = audioCtx.createMediaElementSource(audio);

        analyzer = audioCtx.createAnalyser();

        analyzer.fftSize = 512;

        dataArray = new Uint8Array(analyzer.frequencyBinCount);

        source.connect(analyzer);
        analyzer.connect(audioCtx.destination);

        isInit = true
    }

    // draw visual
    function draw() {
        requestAnimationFrame(draw);
        const { width, height } = canvas;
        ctx.clearRect(0, 0, width, height);

        if (!isInit) {
            return;
        }
        analyzer.getByteFrequencyData(dataArray);

        ctx.fillStyle = "#78C5F7";
        const dataLength = dataArray.length / 3.5;

        const barWidth = width / dataLength / 2;
        for (let i = 0; i < dataLength; i++){
            const data = dataArray[i]; // data < 256

            const barHeight = data /255 * height;
            // duplicate 2 sides
            const x = i * barWidth + width /2;
            const x2 = width /2 - (i +1) * barWidth;
            // const x = i * barWidth;
            const y = height - barHeight;

            // mirror
            ctx.fillRect(x, y, barWidth - 4, barHeight);
            ctx.fillRect(x2, y, barWidth - 4, barHeight);

        }
    }

    draw();

</script>
</html>